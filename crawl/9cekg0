{"url": "https://www.reddit.com/r/learnprogramming/comments/9cekg0/upload_large_files_to_s3_without_authentication/", "text": " I'm trying to upload large files to Amazon S3 without using credentials (I started off using credentials, but it violated AWS TOS). I'm creating a plugin for Octoprint with this, and I can't put any sort of credentials into the code due to it being public. Currently my code for uploads looks like this:\n\n    import boto3 \n    from botocore import UNSIGNED \n    from botocore.client \n    import Config  \n    \n    s3 = boto3.client('s3', config=Config(signature_version=UNSIGNED)) # Create an S3 client   \n    filename = 'file.txt' \n    bucket_name = 'BUCKET_HERE'  \n    \n    s3.upload_file(filename, bucket_name, filename)\n\nHowever, it gives me the following error when I upload anything above 8MB:\n\n    S3UploadFailedError: Failed to upload largefiletest.mp4 to <insert bucket name here>/largefiletest.mp4: An error occurred (AccessDenied) when calling the CreateMultipartUpload operation: Anonymous users cannot initiate multipart uploads. Please authenticate.\n\nIs there any way to work around this, or are there any suggestions for alternative libraries? Anything is appreciated.", "score": 1, "comments": [{"body": "If you have a public S3 bucket that allows uploads without authentication, anyone is free to upload anything they like to it and you will be liable for the costs. What TOS are you breaching by doing what you want to do authenticated?", "id": "e5abzl3", "replies": [{"body": "For some reason, putting the keys online, even for a public bucket, is a TOS violation.\n\nI\u2019m not sure why. It\u2019s the IAM keys specifically.", "id": "e5ac1kn", "replies": [{"body": "Wait, you mean the ones called \u201caccess id\u201d and \u201csecret key\u201d? That\u2019s because if you have those and the ID of your account, you can do anything that IAM user has access to. That is a serious security risk and if you haven\u2019t configured your users correctly, someone will use them for their own gain. Bots trawl GitHub for this sort of thing and spin up bitcoin miners. People have unwittingly racked up bills of $100,000 or more from misconfiguring their accounts and publishing access keys. \n\nIf something violates AWS\u2019s TOS, it\u2019s because they have a good reason for preventing you doing it. ", "id": "e5acgep", "replies": [{"body": "Yeah, I\u2019m aware. I specifically locked down that key with only 1 permission, uploading to s3 buckets. If it\u2019s really not possible to upload large files to S3 without keys, and I\u2019m not able to use the keys, is there an alternative service you would recommend? I need this program to upload the user data to a server of some sort, it doesn\u2019t really matter what, it\u2019s just that AWS is cheap and reliable. But I\u2019m totally open to other libraries and services, I just need it to go *somewhere*.", "id": "e5acoc7", "replies": [{"body": "But why do you need to put the keys online?", "id": "e5acu34", "replies": [{"body": "I\u2019m trying to make a plug-in. For public use. It\u2019s on GitHub. The files being uploaded in this scenario are well above 8MB, the threshold at which Boto3 switches to multipart uploading, which for some reason isn\u2019t allowed by AWS unless you\u2019re using keys.", "id": "e5aczpb", "replies": [{"body": "If your repository is public, it is strongly advised that and keys or passwords are not uploaded and are passed in at compile/runtime as parameters or a config file. If you have previously put keys and passwords in public GitHub repos, change them immediately, even if you have removed them in another commit. Your git history is just as public as you current source. \n\nIt looks like you can avoid multipart uploads by using putObject instead of uploadFile. I don\u2019t know if it also needs authentication. I would strongly advise against making a bucket public though and would look to sort out your access key issue. ", "id": "e5adpr0", "replies": [{"body": "The bucket is set to public. I\u2019ve deleted the keys already. I will give putObject a go, but I\u2019m second guessing myself. What\u2019s the proper way to get user data from a client to a server? I\u2019m new to all of this, and it just seems like I\u2019m doing it all wrong.", "id": "e5adzfv", "replies": [{"body": "Usually you would use pre-signed urls that are created on your server. This allows you to control who can upload (e.g. only users with an account on your service) and doesn't expose any credentials.\n\nMore info here https://docs.aws.amazon.com/AmazonS3/latest/dev/PresignedUrlUploadObject.html", "id": "e5aiycj", "replies": []}]}]}]}]}]}]}]}]}], "title": "Upload Large files to S3 without authentication in Python??"}