{"url": "https://www.reddit.com/r/learnprogramming/comments/9chqyq/php_constant_500_error/", "text": "Essentially, I am attempting to create a basic PHP login system for a small website, and am struggling with the creation of user accounts and subsequent insertion of those accounts into a user database. After having created the necessary forms(posted to the same page, which was reloaded immediately after), I attempted to create a user account. Now, the site returns constant '500' errors upon trying to access the 'sign-up' page. My code is shown below. I am positive that the names of the databases' various tables are correct. Thank you for whatever help you can offer.\n\n    <?php\n    ini_set('display_errors', 1); \n    ini_set('log_errors',1); \n    error_reporting(E_ALL); \n    mysqli_report(MYSQLI_REPORT_ERROR | MYSQLI_REPORT_STRICT);\n    \n    function addUser($username, $name, $email, $password){\n        $host = 'localhost';\n        $user = [REDACTED];\n        $pwrd = [REDACTED];\n        $db = 'userDB';\n    \n        $mysqli = new mysqli($host, $user, $pwrd, $db);\n    \n        if(!filter_var($email, FILTER_VALIDATE_EMAIL)){\n          return 3;\n        }\n    \n        $eMailQuery = $mysqli->prepare('SELECT * FROM users WHERE email = ?');\n        $eMailQuery->bind_param(\"s\", $email);\n    \n        if(mysqli_num_rows(eMailQuery->execute()) == 0){\n            return 2;\n        }\n    \n        $uNameQuery = $mysqli->prepare('SELECT * FROM users WHERE username = ?');\n        $uNameQuery->bind_param(\"s\", $username);\n    \n        if(mysqli_num_rows($uNameQuery->execute()) == 0){\n          return 1;\n        }\n    \n    \n        $hashedPW = password_hash($password, PASSWORD_BCRYPT);\n        $insertStmt = $mysqli->prepare('INSERT INTO users \n                                                (username, name, email, password) \n                                        VALUES(?, ?, ?, ?)');\n        $insertStmt->bind_param('ssss', $username, $name, $email, $hashedPW);\n        $insertStmt->execute();\n    \n        if ( $insertStmt->execute() == true){\n            return 0;\n        }\n    }\n    if(isset($_POST['username']) && isset($_POST['name']) && isset($_POST['email']) && isset($_POST['password']){\n    \t$userName = $_POST['username'];\n    \t$name = $_POST['name'];\n    \t$email = $_POST['email'];\n    \t$password = $_POST['password'];\n    \t\n    \t$status = addUser($userName, $name, $email, $password);\n    \tif ( $status != 0 ){\n    \t    echo \"error: $status \\n\";\n    }\n    ?>", "score": 1, "comments": [{"body": "The second parameter to `password_hash` is a constant, not a string. Remove the quotes.", "id": "e5aufy1", "replies": [{"body": "Thanks for the help, but it's still not loading.", "id": "e5av8me", "replies": [{"body": "Are you getting logs? Can you say more about the error?\n\nAnother issue I see now that I look more carefully is that `if ( $insertStmt->execute() == true)` is missing an opening brace. Your logs should be showing these types of parsing errors.", "id": "e5avvvt", "replies": [{"body": "Yeah, that was an error on my part when copying/pasting. The logs aren't very useful at this point; like I said, the first time I tried to submit data to the site, navigating to the URL just gives me '500' errors. I've fixed all of the mistakes shown on the log though, the only real one being that I'd typed 'filtervar' instead of 'filter_var'.", "id": "e5awq0q", "replies": []}]}]}]}, {"body": "Toward the end of the addUser function you\u2019re executing your query twice, but more importantly your last if statement is missing the opening {", "id": "e5awdh8", "replies": [{"body": "I think I fixed that; I've now assigned insertStmt->execute() to a variable, which is being used in the \"if\". You can see the code edited at the top.", "id": "e5ax0og", "replies": [{"body": "That looks good now. Sorry I missed the filter_var. :)\n\nPlease redact your dB creds.\n\nYou\u2019re also going to get errors/notices if you try to navigate directly to the file since you\u2019re using post variables, but those wouldn\u2019t trip a 500. I recommend using postman or a similar program to test these kind of scripts. \n\nOnly other thing I can think is to check your version of php and the modules that are installed to make sure all of your constants are valid and that mysqli is available to the script.\n\nYour Apache logs may or may not give you some insight, too. Not usually helpful, but has helped me in the past.\n\nOn a side note I recommend sanitizing your post variables as part of setting them. That way you can reuse them in any function without worrying about having to remember to do it in each function.", "id": "e5ay4jm", "replies": []}, {"body": "$userName is set as the post variable and you\u2019re passing $username to the function at the bottom of the script. Since you don\u2019t have a default for username in the function declaration this could be tripping it up.", "id": "e5aybpw", "replies": [{"body": "Thanks, but I'm not sure that'll work. It's definitely *an* issue, but I don't think it's *the* issue. This all started after trying to submit one form, but loading the page doesn't require me to call the function; I've added a conditional before calling 'addUser', so that the script now does so only if the 'post' values are set. Additionally, I've opened the page in incognito, where the 'posts' aren't stored, and gotten the same 500. In case I somehow corrupted the page, I even copied and pasted the code into a separate file and tried to load that, but got another 500. That means that it's nothing within the addUser function, since the error persists even when it's not being called. Unless it's a compilation error(which failed to affect anything prior to the initial form submission), it has to be something outside of the function. I just have no idea what. Could I possibly send a PM so that I can give insight into the full code and give you the link? I honestly have no idea where to go from here.", "id": "e5azmm2", "replies": [{"body": "Feel free to pm me though.", "id": "e5b0cze", "replies": []}]}]}]}]}, {"body": "Your function is expecting 4 parameters and by using $userName when setting the variable and passing through $username to the function the function is only receiving 3 parameters because $username is not set. \n\n$username in not the same as $userName. They are two different variables. ", "id": "e5b093i", "replies": []}], "title": "PHP: Constant 500 Error"}