{"url": "https://www.reddit.com/r/learnprogramming/comments/9bezuc/script_to_reset_pc_if_service_fails_to_start/", "text": "Hi,\n\nI am trying to make a script that will check if a service is running, if not it will start the service, it will then wait a set amount of time and check if the service is running again, if it is still not running it will restart the pc.\n\nI am trying to accomplish this in powershell and this is what I have so far:\n\n    $service = Get-Service -Name \"IP Helper\" | Select -Property Status\n    $service\n    if($service.Status -ne \"Running\")\n    {\n    \tStart-Service -Name \"IP Helper\" \n    \tStart-Sleep 30\n    }\n    else\n    {\n    Write-Host \"Service is Started\"\n    exit\n    }\n    \n    if($service.Status -eq \"Running\")\n        {\n           Write-Host \"Service is Started\"\n           exit \n        }\n        else\n        {\n        shutdown -r -t 60\n        }\n\nThe starting of the service when not running works fine however upon running the script again with it running, even if the if statement is met it still proceeds to perform the else statement and begin shutting down the pc (thank god for shutdown /a command)\n\nIf anyone can tell me where I am going wrong or has a better way of doing this (does not have to be powershell) that would be great.\n\n\u200b\n\nThanks\n\n&#x200B;\n\nedit: note\\* IP Helper is not the service it is being used as a placeholder to test with", "score": 1, "comments": [{"body": "First, I gotta know, why restart the PC?", "id": "e52kva4", "replies": [{"body": "The program uses an SQL Database and it has a tendency to get stuck 'Stopping' or 'Starting' and while we can force these to stop and then start them it usually needs to happen out of business hours when we are not working so we are looking to create this script as a work around for the time being.", "id": "e52l2px", "replies": [{"body": "Have you been trying the `Restart-Computer` command? Such as here: [https://www.neudesic.com/blog/powershell-script-restart-computer-continue-execution/](https://www.neudesic.com/blog/powershell-script-restart-computer-continue-execution/)\n\n&#x200B;\n\nThe SQL database issue sounds like a deeper issue with your configuration. Perhaps you're trying to spin up the service too soon after a reboot? Windows is super finicky, IMO. I used to have issues with services all the time. You could also work on your script to simply kill the actual process. That might make it more likely to actually properly restart. It's not too hard.   \n\n\n`Get-Process | Where-Object { $_.Name -eq \"myprocess\" } | Select-Object -First 1 | Stop-Process` \n\n&#x200B;\n\nWhere myprocess would be the name of your SQL server process.", "id": "e52li7d", "replies": [{"body": "I haven't looked into the Restart-Computer command just been reverting to good old 'shutdown' with switches. I will look in to that. \n\nUnfortunately the SQL database is not ours to mess with we are third party support and the Database is another vendors, the work around is to fix the customers issue while said vendor is looking into the stopping and starting issue.", "id": "e52msrr", "replies": []}]}]}]}], "title": "Script to reset PC if service fails to start."}